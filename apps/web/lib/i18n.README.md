# i18n System Documentation

## Overview

This i18n system provides a clean, type-safe, and performant way to handle translations in the application. It follows the structure defined in `plan/plan.md` and `plan/structure.md`.

## Features

✅ **Type Safety** - TypeScript types for better development experience  
✅ **Performance** - Memoization and caching for optimal performance  
✅ **React Hooks** - Convenient `useTranslation` hook for client components  
✅ **Automatic Fallback** - Falls back to English if translation not found  
✅ **Developer Experience** - Clean API and helpful error messages in development  

## Directory Structure

```
locales/
├── en/
│   ├── common.json      # Global UI elements (buttons, navigation, etc.)
│   ├── home.json        # Home page specific texts
│   ├── product.json     # Product page static labels
│   ├── products.json    # Product-specific translations (by product ID)
│   └── attributes.json  # Attribute labels (color, size, etc.)
└── hy/
    └── (same structure)
```

## API Reference

### `t(lang, path)` - Translation Function

Translates a key path to the corresponding text.

**Parameters:**
- `lang` (optional): Language code (`'en'` | `'hy'`). If not provided, uses stored language.
- `path`: Translation path in format `"namespace.key.subkey"` (e.g., `"common.buttons.addToCart"`)

**Returns:** Translated string or the path if translation not found.

**Example:**
```typescript
import { t } from '../lib/i18n';
import { getStoredLanguage } from '../lib/language';

const lang = getStoredLanguage();
const text = t(lang, 'common.buttons.addToCart'); // "Add to Cart" or "Ավելացնել զամբյուղ"
```

### `getProductText(lang, productId, field)` - Product Text Getter

Gets product-specific text from `products.json`.

**Parameters:**
- `lang` (optional): Language code
- `productId`: Product ID (string)
- `field`: Field name - `'title'` | `'shortDescription'` | `'longDescription'`

**Returns:** Product text or empty string if not found.

**Example:**
```typescript
import { getProductText } from '../lib/i18n';

const title = getProductText('hy', 'product-123', 'title');
const description = getProductText('hy', 'product-123', 'longDescription');
```

### `getAttributeLabel(lang, type, value)` - Attribute Label Getter

Gets translated label for an attribute value.

**Parameters:**
- `lang` (optional): Language code
- `type`: Attribute type (e.g., `'color'`, `'size'`)
- `value`: Attribute value code (e.g., `'red'`, `'xl'`)

**Returns:** Translated label or the original value if not found.

**Example:**
```typescript
import { getAttributeLabel } from '../lib/i18n';

const colorLabel = getAttributeLabel('hy', 'color', 'red'); // "Կարմիր"
const sizeLabel = getAttributeLabel('hy', 'size', 'xl'); // "XL"
```

### `useTranslation()` - React Hook

React hook for client components. Automatically handles language updates and memoization.

**Returns:**
```typescript
{
  t: (path: string) => string;
  lang: LanguageCode;
  getProductText: (productId: string, field: ProductField) => string;
  getAttributeLabel: (type: string, value: string) => string;
}
```

**Example:**
```typescript
'use client';

import { useTranslation } from '../lib/i18n';

export function MyComponent() {
  const { t, getProductText, getAttributeLabel } = useTranslation();

  return (
    <div>
      <button>{t('common.buttons.addToCart')}</button>
      <p>{getProductText('product-123', 'title')}</p>
      <span>{getAttributeLabel('color', 'red')}</span>
    </div>
  );
}
```

## Usage Examples

### Basic Translation

```typescript
// In a client component
import { useTranslation } from '../lib/i18n';

export function Button() {
  const { t } = useTranslation();
  return <button>{t('common.buttons.submit')}</button>;
}
```

### Product Page

```typescript
import { useTranslation } from '../lib/i18n';

export function ProductPage({ productId }: { productId: string }) {
  const { t, getProductText, getAttributeLabel } = useTranslation();

  return (
    <div>
      <h1>{getProductText(productId, 'title')}</h1>
      <p>{getProductText(productId, 'longDescription')}</p>
      <span>{getAttributeLabel('color', 'red')}</span>
      <button>{t('product.addToCart')}</button>
    </div>
  );
}
```

### Server Component (without hook)

```typescript
import { t } from '../lib/i18n';
import { getStoredLanguage } from '../lib/language';

export async function ServerComponent() {
  const lang = getStoredLanguage();
  return <h1>{t(lang, 'home.hero_title')}</h1>;
}
```

## Translation File Structure

### `common.json`
```json
{
  "buttons": {
    "addToCart": "Add to Cart",
    "submit": "Submit"
  },
  "navigation": {
    "home": "Home",
    "products": "Products"
  }
}
```

### `products.json`
```json
{
  "product-123": {
    "title": "Product Title",
    "shortDescription": "Short description",
    "longDescription": "Long description with HTML"
  }
}
```

### `attributes.json`
```json
{
  "color": {
    "red": "Red",
    "blue": "Blue"
  },
  "size": {
    "s": "S",
    "m": "M",
    "l": "L"
  }
}
```

## Best Practices

1. **Always use the hook in client components** - `useTranslation()` handles language updates automatically
2. **Use consistent namespace structure** - Follow the pattern: `namespace.category.key`
3. **Keep keys consistent across languages** - Same keys in all language files
4. **Use fallback values** - The system automatically falls back to English
5. **Cache management** - Translation results are cached automatically (max 1000 entries)

## Performance

- **Build-time loading**: All translations are loaded at build time
- **Memoization**: React hook uses `useMemo` and `useCallback` for optimal re-renders
- **Path caching**: Translation paths are cached (up to 1000 entries)
- **Lazy evaluation**: Only requested translations are processed

## Development

In development mode, the system logs warnings for:
- Invalid translation paths
- Missing translations
- Invalid namespaces

These warnings are disabled in production for better performance.

## Migration from Old System

If you're migrating from the old `translations.ts` system:

1. Replace `getTranslation(key, lang)` with `t(lang, path)`
2. Update path format: `'breadcrumb.home'` → `'common.navigation.home'`
3. Use `useTranslation()` hook instead of manual language state management
4. Replace product text access with `getProductText()`
5. Replace attribute labels with `getAttributeLabel()`



